---
/**
 * WhatsAppButton Component - Specialized button for WhatsApp click-to-chat
 * Opens WhatsApp app on mobile or web.whatsapp.com on desktop
 */
import Button from './Button.astro';
import { getWhatsAppLink } from '../../utils/whatsapp';

interface Props {
  phoneNumber: string;
  message: string;
  label?: string;
  ariaLabel?: string;
  section?: string; // 'hero' | 'contact' - for tracking context
}

const {
  phoneNumber,
  message,
  label = 'Discuter sur WhatsApp',
  ariaLabel = `Contacter Make It Global sur WhatsApp: ${message.substring(0, 50)}...`,
  section = 'contact',
} = Astro.props;
const whatsappUrl = getWhatsAppLink(phoneNumber, message);

// Generate unique ID for this component instance
const uniqueId = `whatsapp-${Math.random().toString(36).substr(2, 9)}`;
---

<Button
  variant="secondary"
  href={whatsappUrl}
  ariaLabel={ariaLabel}
  class={`whatsapp-button whatsapp-${uniqueId}`}
  data-section={section}
>
  {label}
</Button>

<script define:vars={{ uniqueId, section }}>
  // Self-targeting tracking - avoids querySelectorAll
  import { trackWhatsAppClick } from '../../utils/analytics';

  // Use unique class selector for this specific button
  const button = document.querySelector(`.whatsapp-${uniqueId}`);

  if (button) {
    const handleClick = () => {
      trackWhatsAppClick(section);
      // Note: Don't remove listener here since user might click multiple times
      // (each click is a separate conversion event)
    };

    button.addEventListener('click', handleClick);
  }
</script>
